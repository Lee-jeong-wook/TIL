# 인터럽트
### 인터럽트란?
* CPU가 프로그램을 실행하고 있을 떄 입출력 하드웨어 등의 장치나 또는 예외상황이 발생하여 처리가 필요한 경우에 CPU에 알려서 처리하는 기술
* 일종의 이벤트로 불림, 이벤트에 맞게 운영체제가 처리
### 필요 이유
* 선점형 스케쥴러 구현
> * 프로세스 running 중에 스케쥴러가 이를 중단시키고, 다른 프로세스로 교체하기 위해 현제 프로세스 중단
> * 스케쥴러 코드가 실행이 되어 현 프로세스 실행 중지시켜야함
* IO Device와의 커뮤케이션
> * 저장매체에서 데이터 처리 완료시 프로세스를 깨워야함(Block -> Ready)
* 예외상황 핸들링
> * CPU가 프로그램을 실행하고 있을 떄 입출력 하드웨어 등의 장치나 또는 예외상황이 발생할 경우 CPU가 해당 처리를 할 수 이ㅆ도록 CPU에 알려줘야 함
### 인터럽트 예시
* 입출력 하드웨어 등의 장치 이슈 발생
> 운영체제는 해당 프로세스를 block state에서 ready로 변셩
* 예외 상황 발생
> 운영체제가 해당 프로세스 실행 중지 및 에러 표시
### 주요 인터럽트
##### 내부 인터럽트
* 계산식에서 0으로 나누기
* 사용자 모드에서 허용되지 않은 명령어 또는 공간 접근
* overflow 혹은 underflow
##### 외부 인터럽트
* IO 인터럽트
* 기계 문제
* 전원 이상
* 타이머 인터럽트(선점형 스케쥴러)
##### 시스템 콜 인터럽트
* 시스템 콜 실행을 위해서는 강제로 코드에 인터럽ㅇ트 명령을 넣어 CPU에서 실행
### 인터럽트와 시스템 콜
* CPU는 사용자 모드를 커널 모드로 바꿔줌
* IDT에서 0x80에 해당하는 주소를 찾아 실행
* System_call()함수에서 eax로부터 시스템 콜 번호를 찾아서, 해당 번호에 맞는 시스템 콜 함수로 이동
* 해당 시스템 콜 함수 실행후, 다시 커널 모드에서 사용자 모드로 변경하고 다시 해당 프로세스 다음 코드 진행
### 인터럽트와 IDT
* 인터럽트는 미리 정의되어 각각 번호와 운영체제 내부 실행코드를 가리키는 주소가 IDT에 컴퓨터 부팅시 기록
* 인터럽트 발생시 IDT 확인
* 시스템 콜 인터럽트 명령은 0x80번호가 미리 정의
* 인터럽트 0x80에 해당하는 운영체제 코드는 system_call()함수
* 즉 IDT에 0x80->system_call()와 같은 정보가 기록되어 있음
* **리눅스 예시**
> * 0~31 : 예외상황 인터럽트(일부는 정의되지 않은 채 남아 있음)
> * 32~47 : 하드웨어 인터럽트(주변장치 종류/개수에 따라 변경 가능)
> * 128:시스템 콜
### 인터럽트와 프로세스
* 프로세스 실행 중 인터럽트
* 현 프로세스 실행 중단
* 인터럽트 처리 함수 실행
* 현 프로세스 재실행
### 인터럽트와 선점형
* 수시로 타이머 인터럽트